CMAKE_MINIMUM_REQUIRED ( VERSION 3.2 FATAL_ERROR )
PROJECT(Ellogon VERSION 3.0 LANGUAGES CXX)

OPTION ( INSTALL_INTO_SOURCES "Install binaries also on sources folder" ON )

if(NOT CMAKE_DEBUG_POSTFIX)
  set(CMAKE_DEBUG_POSTFIX d)
endif()

if(CMAKE_BUILD_TYPE MATCHES Release)
else(CMAKE_BUILD_TYPE MATCHES Release)
endif(CMAKE_BUILD_TYPE MATCHES Release)

if( CMAKE_SIZEOF_VOID_P EQUAL 8 )
  MESSAGE( "Detecting architecture: 64 bits compiler detected" )
  SET( EX_PLATFORM 64 )
  SET( EX_PLATFORM_NAME "x86_64" )
else( CMAKE_SIZEOF_VOID_P EQUAL 8 )
  MESSAGE( "Detecting architecture: 32 bits compiler detected" )
  SET( EX_PLATFORM 32 )
  SET( EX_PLATFORM_NAME "ix86" )
endif( CMAKE_SIZEOF_VOID_P EQUAL 8 )

SET( EX_ARCH_BUILD_DIR ${CMAKE_SYSTEM_NAME}/${CMAKE_BUILD_TYPE}/${EX_PLATFORM_NAME} )
SET( EX_ARCH_DIR ${CMAKE_SYSTEM_NAME}/${EX_PLATFORM_NAME} )
SET( EX_BINARY_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/${EX_ARCH_BUILD_DIR} )
SET( EX_SOURCES_BINARY_DIRECTORY
        ${CMAKE_CURRENT_SOURCE_DIR}/../../bin/${EX_ARCH_DIR} )
SET ( ELLOGON_BINARY_DIR bin/${EX_ARCH_DIR} )
MESSAGE( "Binary directory: " ${EX_BINARY_DIRECTORY} )

FUNCTION ( EX_INSTALL component target )
IF ( INSTALL_INTO_SOURCES )
  INSTALL ( TARGETS ${target} ${ARGN}
    RUNTIME DESTINATION ${EX_SOURCES_BINARY_DIRECTORY} COMPONENT ${component}
    LIBRARY DESTINATION ${EX_SOURCES_BINARY_DIRECTORY} COMPONENT ${component}
    ARCHIVE DESTINATION ${EX_SOURCES_BINARY_DIRECTORY} COMPONENT ${component}
  )
ENDIF ( INSTALL_INTO_SOURCES )
  INSTALL ( TARGETS ${target} ${ARGN}
    RUNTIME DESTINATION ${ELLOGON_BINARY_DIR} COMPONENT ${component}
    LIBRARY DESTINATION ${ELLOGON_BINARY_DIR} COMPONENT ${component}
    ARCHIVE DESTINATION ${ELLOGON_BINARY_DIR} COMPONENT ${component}
  )
ENDFUNCTION ( EX_INSTALL )

ADD_SUBDIRECTORY ( ../../src ${EX_BINARY_DIRECTORY} )
